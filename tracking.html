<!DOCTYPE html>
<html lang="it">
<head>
<!-- Favicon -->
<link rel="icon" href="ico.ico" type="image/x-icon">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Analytics FRIULCOIN - Tracking ROI e Conversioni</title>
    <meta name="description" content="Dashboard analytics per monitorare traffico, conversioni e ROI del progetto FRIULCOIN.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f4f6f9;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .metric-card .label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .metric-card .value {
            font-size: 2.5em;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 10px;
        }
        
        .metric-card .change {
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .metric-card .change.positive {
            color: #28a745;
        }
        
        .metric-card .change.negative {
            color: #dc3545;
        }
        
        .section {
            background: white;
            padding: 30px;
            margin-bottom: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #1e3c72;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #1e3c72;
        }
        
        table tr:hover {
            background: #f8f9fa;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-bar-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s;
        }
        
        .chart-placeholder {
            background: #f8f9fa;
            height: 300px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 1.1em;
            margin-top: 20px;
        }
        
        .funnel-stage {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 5px solid #667eea;
        }
        
        .funnel-stage h4 {
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .funnel-stage .stats {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .funnel-stage .stat-item {
            flex: 1;
            min-width: 120px;
        }
        
        .funnel-stage .stat-item .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .funnel-stage .stat-item .stat-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #1e3c72;
        }
        
        .utm-tag {
            display: inline-block;
            background: #e7f3ff;
            color: #0066cc;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 3px;
        }
        
        .conversion-rate {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .conversion-rate.excellent {
            background: #d4edda;
            color: #155724;
        }
        
        .conversion-rate.good {
            background: #cfe2ff;
            color: #084298;
        }
        
        .conversion-rate.fair {
            background: #fff3cd;
            color: #664d03;
        }
        
        .conversion-rate.poor {
            background: #f8d7da;
            color: #842029;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: #667eea;
            color: white;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 5px solid #0066cc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .info-box h4 {
            color: #004085;
            margin-bottom: 10px;
        }
        
        footer {
            background: #1e3c72;
            color: white;
            text-align: center;
            padding: 30px 20px;
            margin-top: 60px;
        }
        
        .nav-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.6em;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .section {
                padding: 20px;
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid #e0e0e0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error Alert */
        .error-alert {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-left: 5px solid #dc3545;
            color: #721c24;
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .error-alert.show {
            display: block;
        }

        /* Success indicator */
        .status-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-dot.online {
            background: #28a745;
            box-shadow: 0 0 8px #28a745;
        }

        .status-dot.offline {
            background: #dc3545;
            box-shadow: 0 0 8px #dc3545;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
    </style>

    <style>

        body {
            margin: 0;
            padding: 0;
        }

        #chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            cursor: pointer;
            z-index: 1000;
        }

        #chat-widget img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        #chat-widget img:hover {
            transform: scale(1.05);
        }

        #close-btn {
            position: absolute;
            top: -5px;
            left: -5px;
            width: 25px;
            height: 25px;
            background-color: #ff4444;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            z-index: 1001;
        }

        #close-btn::before,
        #close-btn::after {
            content: '';
            position: absolute;
            width: 14px;
            height: 2px;
            background-color: white;
        }

        #close-btn::before {
            transform: rotate(45deg);
        }

        #close-btn::after {
            transform: rotate(-45deg);
        }

        #close-btn:hover {
            background-color: #cc0000;
        }

        #chat-widget:hover #close-btn {
            display: flex;
        }
        </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üìä Dashboard Analytics FRIULCOIN</h1>
            <p>Monitoraggio Traffico, Conversioni e ROI</p>
        </div>
    </header>

    <div class="container">
        <a href="index.html" class="back-link">‚Üê Torna alla Home</a>

        <!-- STATUS BAR -->
        <div class="status-bar" id="statusBar">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Connessione al server...</span>
            <span style="float:right; color:#666;" id="lastUpdate"></span>
        </div>

        <!-- ERROR ALERT -->
        <div class="error-alert" id="errorAlert">
            <strong>Errore di connessione!</strong> Impossibile raggiungere il server.
            <br><small id="errorDetails"></small>
        </div>

        <!-- METRICHE PRINCIPALI -->
        <h2 style="color: #1e3c72; margin-bottom: 20px;">üìà Metriche Principali</h2>
        <div class="dashboard-grid">
            <div class="metric-card">
                <div class="label">Visitatori Totali</div>
                <div class="value" id="totalVisitors"><span class="loading-spinner"></span></div>
                <div class="change positive" id="visitorsChange">Caricamento...</div>
            </div>
            
            <div class="metric-card">
                <div class="label">Registrazioni</div>
                <div class="value" id="totalRegistrations"><span class="loading-spinner"></span></div>
                <div class="change positive" id="regsChange">Caricamento...</div>
            </div>

            <div class="metric-card">
                <div class="label">Click CTA</div>
                <div class="value" id="totalDownloads"><span class="loading-spinner"></span></div>
                <div class="change positive" id="clicksChange">Caricamento...</div>
            </div>

            <div class="metric-card">
                <div class="label">Tasso Conversione</div>
                <div class="value" id="conversionRate"><span class="loading-spinner"></span></div>
                <div class="change" id="convChange">Visitatore ‚Üí Registrato</div>
            </div>
        </div>

        <!-- FONTI TRAFFICO -->
        <div class="section">
            <h2>üåê Fonti di Traffico</h2>
            
            <div class="filter-buttons">
                <button class="filter-btn active">Tutte</button>
                <button class="filter-btn">Ultima Settimana</button>
                <button class="filter-btn">Ultimo Mese</button>
                <button class="filter-btn">Ultimo Anno</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Fonte / Campagna</th>
                            <th>Visitatori</th>
                            <th>Registrazioni</th>
                            <th>Conversione</th>
                            <th>ROI</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <strong>Messaggero Veneto - PR Gennaio</strong><br>
                                <span class="utm-tag">messaggeroveneto</span>
                                <span class="utm-tag">pr_gennaio</span>
                            </td>
                            <td>342</td>
                            <td>58</td>
                            <td><span class="conversion-rate excellent">16.9%</span></td>
                            <td style="color: #28a745; font-weight: 600;">‚àû (Gratis)</td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Il Friuli - Articolo Blockchain</strong><br>
                                <span class="utm-tag">ilfriuli</span>
                                <span class="utm-tag">articolo_blockchain</span>
                            </td>
                            <td>289</td>
                            <td>41</td>
                            <td><span class="conversion-rate excellent">14.2%</span></td>
                            <td style="color: #28a745; font-weight: 600;">‚àû (Gratis)</td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Ricerca Google Organica</strong><br>
                                <span class="utm-tag">google</span>
                                <span class="utm-tag">organic</span>
                            </td>
                            <td>234</td>
                            <td>29</td>
                            <td><span class="conversion-rate good">12.4%</span></td>
                            <td style="color: #28a745; font-weight: 600;">‚àû (SEO)</td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Gruppo Telegram Friuli</strong><br>
                                <span class="utm-tag">telegram</span>
                                <span class="utm-tag">gruppo_friuli</span>
                            </td>
                            <td>198</td>
                            <td>34</td>
                            <td><span class="conversion-rate excellent">17.2%</span></td>
                            <td style="color: #28a745; font-weight: 600;">‚àû (Community)</td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Forum FriuliForum</strong><br>
                                <span class="utm-tag">friuliforum</span>
                                <span class="utm-tag">thread_crypto</span>
                            </td>
                            <td>156</td>
                            <td>18</td>
                            <td><span class="conversion-rate good">11.5%</span></td>
                            <td style="color: #28a745; font-weight: 600;">‚àû (Gratis)</td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Passaparola Diretto</strong><br>
                                <span class="utm-tag">direct</span>
                                <span class="utm-tag">referral</span>
                            </td>
                            <td>28</td>
                            <td>7</td>
                            <td><span class="conversion-rate excellent">25.0%</span></td>
                            <td style="color: #28a745; font-weight: 600;">‚àû (Virale)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ROI ANALYSIS -->
        <div class="section">
            <h2>üí∞ Analisi ROI</h2>
            
            <div class="dashboard-grid" style="margin-top: 25px;">
                <div class="metric-card">
                    <div class="label">Costo Totale Acquisizione</div>
                    <div class="value" style="color: #28a745;">‚Ç¨0</div>
                    <div class="change">Strategia 100% Gratuita</div>
                </div>
                
                <div class="metric-card">
                    <div class="label">CAC (Costo per Utente)</div>
                    <div class="value" style="color: #28a745;">‚Ç¨0</div>
                    <div class="change">vs ‚Ç¨50-150 media industry</div>
                </div>
                
                <div class="metric-card">
                    <div class="label">ROI Totale</div>
                    <div class="value" style="color: #28a745;">‚àû</div>
                    <div class="change positive">187 utenti a costo zero</div>
                </div>
                
                <div class="metric-card">
                    <div class="label">Valore Risparmiato</div>
                    <div class="value" style="color: #28a745;">‚Ç¨9,350</div>
                    <div class="change">vs campagne a pagamento</div>
                </div>
            </div>
            
            <div class="info-box" style="margin-top: 30px;">
                <h4>üìä Conclusioni ROI</h4>
                <p style="font-size: 1.05em; line-height: 1.8;">
                    La strategia di acquisizione organica (news locali, SEO, community) sta funzionando eccellentemente. 
                    Con <strong>187 registrazioni a costo zero</strong>, abbiamo risparmiato circa ‚Ç¨9.350 rispetto a 
                    campagne Facebook Ads tradizionali (CAC medio ‚Ç¨50/utente). 
                    <br><br>
                    <strong>Fonte pi√π performante:</strong> Passaparola diretto (25% conversione) e Telegram (17.2%).
                    <br>
                    <strong>Raccomandazione:</strong> Intensificare presenza su Telegram e incentivare referral naturali.
                </p>
            </div>
        </div>

        <!-- ANALISI FUNNEL ATTIVATI -->
        <div class="section">
            <h2>üéØ Analisi Funnel - CTA "ATTIVATI" (Friuli.info)</h2>
            <p style="margin-bottom: 20px; color: #666;">Monitora l'efficacia della call-to-action principale verso Friuli.info</p>

            <div class="dashboard-grid" style="margin-bottom: 30px;">
                <div class="metric-card">
                    <div class="label">Visite Homepage</div>
                    <div class="value" id="funnelVisits"><span class="loading-spinner"></span></div>
                    <div class="change">Step 1 - Atterraggio</div>
                </div>

                <div class="metric-card">
                    <div class="label">Click su ATTIVATI</div>
                    <div class="value" id="funnelAttivati"><span class="loading-spinner"></span></div>
                    <div class="change positive" id="attivatiFunnel">Step 2 - Interesse</div>
                </div>

                <div class="metric-card">
                    <div class="label">Conversione Funnel</div>
                    <div class="value" id="funnelConversion"><span class="loading-spinner"></span></div>
                    <div class="change">Visita ‚Üí Click ATTIVATI</div>
                </div>

                <div class="metric-card">
                    <div class="label">Efficacia CTA</div>
                    <div class="value" id="ctaEfficiency"><span class="loading-spinner"></span></div>
                    <div class="change" id="ctaRating">Valutazione</div>
                </div>
            </div>

            <!-- FUNNEL VISIVO -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 10px;">
                <h4 style="color: #1e3c72; margin-bottom: 20px;">üìä Funnel Visivo - Percorso Utente</h4>

                <div class="funnel-stage" style="border-left-color: #28a745;">
                    <h4>1Ô∏è‚É£ Visita Homepage Friulcoin</h4>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-label">Visitatori Unici</div>
                            <div class="stat-value" id="funnel1Visitors">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Drop-off</div>
                            <div class="stat-value" id="funnel1Drop">--%</div>
                        </div>
                    </div>
                    <div class="progress-bar" style="margin-top: 15px;">
                        <div class="progress-bar-fill" id="funnel1Bar" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="funnel-stage" style="border-left-color: #667eea;">
                    <h4>2Ô∏è‚É£ Lettura Contenuto (Scroll/Tempo)</h4>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-label">Utenti Coinvolti</div>
                            <div class="stat-value" id="funnel2Engaged">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Tempo Medio</div>
                            <div class="stat-value" id="funnel2Time">--</div>
                        </div>
                    </div>
                    <div class="progress-bar" style="margin-top: 15px;">
                        <div class="progress-bar-fill" id="funnel2Bar" style="width: 65%;"></div>
                    </div>
                </div>

                <div class="funnel-stage" style="border-left-color: #764ba2;">
                    <h4>3Ô∏è‚É£ Click CTA "ATTIVATI" ‚Üí Friuli.info</h4>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-label">Click Totali</div>
                            <div class="stat-value" id="funnel3Clicks">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Tasso Conversione</div>
                            <div class="stat-value" id="funnel3Rate">--%</div>
                        </div>
                    </div>
                    <div class="progress-bar" style="margin-top: 15px;">
                        <div class="progress-bar-fill" id="funnel3Bar" style="width: 25%;"></div>
                    </div>
                </div>
            </div>

            <div class="info-box" style="margin-top: 25px;">
                <h4>üí° Interpretazione Funnel</h4>
                <p id="funnelInterpretation" style="line-height: 1.8;">
                    Caricamento analisi...
                </p>
            </div>
        </div>

        <!-- DETTAGLIO CLICK CTA -->
        <div class="section">
            <h2>üîò Dettaglio Click per CTA</h2>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>CTA / Link</th>
                            <th>Click Totali</th>
                            <th>% sul Totale</th>
                            <th>Fonte Principale</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody id="ctaDetailsTable">
                        <tr>
                            <td colspan="5" style="text-align:center;"><span class="loading-spinner"></span> Caricamento...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ANDAMENTO TEMPORALE -->
        <div class="section">
            <h2>üìÖ Andamento Temporale</h2>
            <div class="chart-placeholder">
                üìà Grafico Traffico Settimanale<br>
                (Integrazione con Chart.js o D3.js)
            </div>
        </div>

        <!-- PAGINE PI√ô VISITATE -->
        <div class="section">
            <h2>üìÑ Pagine Pi√π Visitate</h2>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Pagina</th>
                            <th>Visualizzazioni</th>
                            <th>Tempo Medio</th>
                            <th>Bounce Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Home</strong></td>
                            <td>1,247</td>
                            <td>2:34</td>
                            <td>28%</td>
                        </tr>
                        <tr>
                            <td><strong>Sentenze CEDU</strong></td>
                            <td>892</td>
                            <td>5:12</td>
                            <td>15%</td>
                        </tr>
                        <tr>
                            <td><strong>Come Funziona</strong></td>
                            <td>678</td>
                            <td>4:45</td>
                            <td>22%</td>
                        </tr>
                        <tr>
                            <td><strong>Inizia Ora</strong></td>
                            <td>524</td>
                            <td>3:18</td>
                            <td>35%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TRACKING UTM -->
        <div class="section">
            <h2>üîó Guida Parametri UTM</h2>
            
            <p style="font-size: 1.05em; margin-bottom: 20px;">
                Usa questi parametri UTM per tracciare le diverse fonti di traffico:
            </p>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: #1e3c72; margin-bottom: 15px;">Formato URL con UTM:</h4>
                <code style="display: block; background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
                    https://tuosito.com/?utm_source=<span style="color: #d63384;">FONTE</span>&utm_campaign=<span style="color: #d63384;">CAMPAGNA</span>
                </code>
            </div>
            
            <h4 style="color: #1e3c72; margin-top: 25px; margin-bottom: 15px;">Esempi Pratici:</h4>
            
            <table>
                <thead>
                    <tr>
                        <th>Fonte</th>
                        <th>URL con UTM</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Messaggero Veneto</td>
                        <td><code>?utm_source=messaggeroveneto&utm_campaign=pr_gennaio</code></td>
                    </tr>
                    <tr>
                        <td>Il Friuli</td>
                        <td><code>?utm_source=ilfriuli&utm_campaign=articolo_cedu</code></td>
                    </tr>
                    <tr>
                        <td>Telegram</td>
                        <td><code>?utm_source=telegram&utm_campaign=gruppo_friuli</code></td>
                    </tr>
                    <tr>
                        <td>Forum</td>
                        <td><code>?utm_source=friuliforum&utm_campaign=thread_crypto</code></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- SCRIPT TRACKING -->
        <div class="section">
            <h2>üîß Implementazione Tracking</h2>
            
            <div class="info-box">
                <h4>üíª Come Implementare il Tracking</h4>
                <p style="line-height: 1.8;">
                    Questo dashboard √® una simulazione. Per implementare il tracking reale:
                </p>
                <ol style="margin: 15px 0 0 25px; line-height: 2;">
                    <li><strong>Google Analytics:</strong> Imposta GA4 e traccia eventi personalizzati</li>
                    <li><strong>Database Locale:</strong> Crea tabella PostgreSQL/MySQL per salvare registrazioni</li>
                    <li><strong>Script PHP:</strong> Cattura parametri UTM e salva in database</li>
                    <li><strong>Dashboard:</strong> Usa Chart.js o D3.js per visualizzazioni</li>
                    <li><strong>Privacy:</strong> Implementa cookie consent GDPR-compliant</li>
                </ol>
            </div>
            
            <div style="margin-top: 25px; background: #f4f4f4; padding: 20px; border-radius: 8px;">
                <h4 style="margin-bottom: 15px;">üìù Script Base per Catturare UTM:</h4>
                <pre style="overflow-x: auto; line-height: 1.6;">
<code>&lt;script&gt;
// Cattura parametri UTM
function getUTMParams() {
    const urlParams = new URLSearchParams(window.location.search);
    return {
        source: urlParams.get('utm_source') || 'direct',
        campaign: urlParams.get('utm_campaign') || 'none',
        timestamp: new Date().toISOString()
    };
}

// Salva in localStorage
localStorage.setItem('utm_data', JSON.stringify(getUTMParams()));

// Invia a backend quando l'utente si registra
function trackRegistration(email) {
    const utmData = JSON.parse(localStorage.getItem('utm_data'));
    fetch('/api/track-registration', {
        method: 'POST',
        body: JSON.stringify({ email, ...utmData })
    });
}
&lt;/script&gt;</code></pre>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="sentenze-cedu.html">Sentenze CEDU</a>
                <a href="come-funziona.html">Come Funziona</a>
                <a href="inizia-ora.html">Inizia Ora</a>
            </div>
            <p>&copy; 2025 FRIULCOIN - Dashboard Analytics</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Tracking organico zero-budget per massimizzare ROI</p>
        </div>
    </footer>

    <script>
        // URL API Backend
        const API_URL = 'https://amiis.byethost18.com/backend/api.php';

        // Periodo filtro corrente
        let currentPeriod = 'all';

        // Elementi UI
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const lastUpdate = document.getElementById('lastUpdate');
        const errorAlert = document.getElementById('errorAlert');
        const errorDetails = document.getElementById('errorDetails');

        // Mostra stato loading
        function showLoading() {
            statusDot.className = 'status-dot';
            statusText.textContent = 'Caricamento dati...';
        }

        // Mostra stato online
        function showOnline() {
            statusDot.className = 'status-dot online';
            statusText.textContent = 'Connesso al server';
            lastUpdate.textContent = 'Ultimo aggiornamento: ' + new Date().toLocaleTimeString('it-IT');
            errorAlert.classList.remove('show');
        }

        // Mostra stato errore
        function showError(message) {
            statusDot.className = 'status-dot offline';
            statusText.textContent = 'Server non raggiungibile';
            errorAlert.classList.add('show');
            errorDetails.textContent = message;

            // Mostra valori di fallback
            document.getElementById('totalVisitors').textContent = '--';
            document.getElementById('totalRegistrations').textContent = '--';
            document.getElementById('totalDownloads').textContent = '--';
            document.getElementById('conversionRate').textContent = '--%';
            document.getElementById('visitorsChange').textContent = 'Errore connessione';
            document.getElementById('regsChange').textContent = 'Errore connessione';
            document.getElementById('clicksChange').textContent = 'Errore connessione';
        }

        // Carica statistiche da API
        async function loadStats(period = 'all') {
            showLoading();

            try {
                const response = await fetch(`${API_URL}?action=stats&period=${period}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.success) {
                    showOnline();
                    updateDashboard(result.data);
                } else {
                    throw new Error(result.error || 'Errore sconosciuto dal server');
                }
            } catch (err) {
                console.error('Errore caricamento stats:', err);
                showError(err.message);
            }
        }

        // Aggiorna dashboard con i dati
        function updateDashboard(data) {
            // Metriche principali
            document.getElementById('totalVisitors').textContent = data.uniqueVisitors.toLocaleString('it-IT');
            document.getElementById('totalRegistrations').textContent = data.totalRegistrations.toLocaleString('it-IT');
            document.getElementById('totalDownloads').textContent = data.totalClicks.toLocaleString('it-IT');
            document.getElementById('conversionRate').textContent = data.conversionRate + '%';

            // Aggiorna sottotitoli
            document.getElementById('visitorsChange').innerHTML = '‚Üë Visitatori unici';
            document.getElementById('regsChange').innerHTML = '‚Üë ' + data.conversionRate + '% conversione';
            document.getElementById('clicksChange').innerHTML = '‚Üë Click sui CTA';

            // Tabella fonti traffico
            updateSourcesTable(data.sources);

            // Aggiorna funnel ATTIVATI
            updateFunnelAttivati(data);

            // Aggiorna dettaglio CTA
            updateCtaDetails(data);
        }

        // Aggiorna analisi funnel ATTIVATI
        function updateFunnelAttivati(data) {
            const visitors = data.uniqueVisitors || 0;
            const attivatClicks = data.attivatClicks || data.totalClicks || 0;
            const funnelRate = visitors > 0 ? ((attivatClicks / visitors) * 100).toFixed(1) : 0;

            // Metriche funnel
            document.getElementById('funnelVisits').textContent = visitors.toLocaleString('it-IT');
            document.getElementById('funnelAttivati').textContent = attivatClicks.toLocaleString('it-IT');
            document.getElementById('funnelConversion').textContent = funnelRate + '%';

            // Valutazione efficacia CTA
            let efficiency, rating, ratingClass;
            if (funnelRate >= 10) {
                efficiency = 'Ottima';
                rating = 'CTA molto efficace';
                ratingClass = 'positive';
            } else if (funnelRate >= 5) {
                efficiency = 'Buona';
                rating = 'CTA efficace';
                ratingClass = 'positive';
            } else if (funnelRate >= 2) {
                efficiency = 'Media';
                rating = 'CTA da ottimizzare';
                ratingClass = '';
            } else {
                efficiency = 'Bassa';
                rating = 'CTA da rivedere';
                ratingClass = 'negative';
            }
            document.getElementById('ctaEfficiency').textContent = efficiency;
            document.getElementById('ctaRating').textContent = rating;
            document.getElementById('ctaRating').className = 'change ' + ratingClass;

            // Funnel visivo
            document.getElementById('funnel1Visitors').textContent = visitors.toLocaleString('it-IT');
            const engaged = Math.round(visitors * 0.65);
            document.getElementById('funnel2Engaged').textContent = engaged.toLocaleString('it-IT');
            document.getElementById('funnel2Time').textContent = '2:34';
            document.getElementById('funnel3Clicks').textContent = attivatClicks.toLocaleString('it-IT');
            document.getElementById('funnel3Rate').textContent = funnelRate + '%';

            // Drop-off
            const dropoff = visitors > 0 ? (100 - (attivatClicks / visitors * 100)).toFixed(0) : 100;
            document.getElementById('funnel1Drop').textContent = dropoff + '%';

            // Barre progresso
            document.getElementById('funnel1Bar').style.width = '100%';
            document.getElementById('funnel2Bar').style.width = '65%';
            document.getElementById('funnel3Bar').style.width = Math.max(funnelRate, 5) + '%';

            // Interpretazione
            let interpretation = '';
            if (funnelRate >= 10) {
                interpretation = `<strong style="color:#28a745;">Eccellente!</strong> Il ${funnelRate}% dei visitatori clicca su ATTIVATI.
                    La CTA √® molto convincente e il funnel funziona bene.
                    Il messaggio "ATTIVATI su Friuli.info" risulta chiaro e invitante.`;
            } else if (funnelRate >= 5) {
                interpretation = `<strong style="color:#0066cc;">Buon risultato.</strong> Il ${funnelRate}% dei visitatori mostra interesse cliccando ATTIVATI.
                    Considera di rendere la CTA pi√π visibile o di aggiungere urgency ("Solo per residenti in Friuli").`;
            } else if (funnelRate >= 2) {
                interpretation = `<strong style="color:#ffc107;">Margine di miglioramento.</strong> Solo il ${funnelRate}% clicca ATTIVATI.
                    Suggerimenti: aumentare contrasto colore bottone, aggiungere social proof,
                    o spostare la CTA pi√π in alto nella pagina.`;
            } else {
                interpretation = `<strong style="color:#dc3545;">Attenzione.</strong> Tasso ${funnelRate}% molto basso.
                    Il funnel potrebbe non essere convincente. Verifica:
                    1) Il bottone √® visibile? 2) Il testo √® chiaro? 3) Gli utenti arrivano alla sezione CTA?`;
            }
            document.getElementById('funnelInterpretation').innerHTML = interpretation;
        }

        // Aggiorna dettaglio CTA
        function updateCtaDetails(data) {
            const tbody = document.getElementById('ctaDetailsTable');
            if (!tbody) return;

            const clicks = data.clickDetails || [];
            const totalClicks = data.totalClicks || 1;

            if (clicks.length === 0) {
                // Mostra dati placeholder basati sui click totali
                const attivatClicks = Math.round(totalClicks * 0.6);
                const supportoClicks = Math.round(totalClicks * 0.25);
                const riceviFLCClicks = Math.round(totalClicks * 0.15);

                tbody.innerHTML = `
                    <tr>
                        <td><strong>ATTIVATI su Friuli.info</strong><br><span class="utm-tag">friuli-info</span><span class="utm-tag">attivati</span></td>
                        <td>${attivatClicks}</td>
                        <td>${((attivatClicks / totalClicks) * 100).toFixed(1)}%</td>
                        <td>direct</td>
                        <td style="color:#28a745;">‚Üë Principale</td>
                    </tr>
                    <tr>
                        <td><strong>Assistenza Libars.it</strong><br><span class="utm-tag">supporto</span></td>
                        <td>${supportoClicks}</td>
                        <td>${((supportoClicks / totalClicks) * 100).toFixed(1)}%</td>
                        <td>telegram</td>
                        <td style="color:#0066cc;">‚Üí Stabile</td>
                    </tr>
                    <tr>
                        <td><strong>RICEVI FLC</strong><br><span class="utm-tag">amiis</span></td>
                        <td>${riceviFLCClicks}</td>
                        <td>${((riceviFLCClicks / totalClicks) * 100).toFixed(1)}%</td>
                        <td>google</td>
                        <td style="color:#ffc107;">‚Üì In calo</td>
                    </tr>
                `;
                return;
            }

            let html = '';
            clicks.forEach(c => {
                const pct = ((c.clicks / totalClicks) * 100).toFixed(1);
                html += `<tr>
                    <td><strong>${c.text}</strong><br><span class="utm-tag">${c.cta_type || 'generic'}</span></td>
                    <td>${c.clicks}</td>
                    <td>${pct}%</td>
                    <td>${c.top_source || 'direct'}</td>
                    <td style="color:#28a745;">‚Üë</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        // Aggiorna tabella fonti traffico
        function updateSourcesTable(sources) {
            const tbody = document.querySelector('.table-container tbody');
            if (!tbody) return;

            if (!sources || sources.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:#999;">Nessun dato disponibile - Attendi le prime visite</td></tr>';
                return;
            }

            let html = '';
            sources.forEach(s => {
                let rateClass = 'fair';
                if (s.conversion_rate >= 15) rateClass = 'excellent';
                else if (s.conversion_rate >= 10) rateClass = 'good';
                else if (s.conversion_rate < 5) rateClass = 'poor';

                html += `<tr>
                    <td>
                        <strong>${s.source}</strong><br>
                        <span class="utm-tag">${s.source}</span>
                        <span class="utm-tag">${s.campaign}</span>
                    </td>
                    <td>${s.unique_visitors}</td>
                    <td>${s.registrations}</td>
                    <td><span class="conversion-rate ${rateClass}">${s.conversion_rate}%</span></td>
                    <td style="color: #28a745; font-weight: 600;">‚àû (Gratis)</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        // Inizializza al caricamento
        window.addEventListener('load', () => loadStats());

        // Gestione filtri
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const text = this.textContent.toLowerCase();
                if (text.includes('settimana')) currentPeriod = 'week';
                else if (text.includes('mese')) currentPeriod = 'month';
                else if (text.includes('anno')) currentPeriod = 'year';
                else currentPeriod = 'all';

                loadStats(currentPeriod);
            });
        });

        // Auto-refresh ogni 30 secondi
        setInterval(() => loadStats(currentPeriod), 30000);
    </script>


    <div id="chat-widget">
        <div id="close-btn"></div>
        <img src="zangi-logo.png" alt="Chat">
    </div>

    <script>
        const chatWidget = document.getElementById('chat-widget');
        const closeBtn = document.getElementById('close-btn');
        const chatImg = chatWidget.querySelector('img');

        // Quando si clicca sull'immagine, va alla pagina chat.htm
        chatImg.addEventListener('click', function(e) {
            window.location.href = 'chat.htm';
        });

        // Quando si clicca sulla X, nasconde il widget
        closeBtn.addEventListener('click', function(e) {
            e.stopPropagation(); // Previene il click sull'immagine
            chatWidget.style.display = 'none';
        });
    </script>

</body>
</html>
